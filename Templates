import matplotlib.pyplot as plt
import pandas as pd

# Assuming the data is already in `claim_df` with 'year_month' and 'claimTotalChargeAmt'

# Filter the data for the specific month
specific_month_data = claim_df[claim_df['year_month'] == '2022-01']

# Sort the claim amounts in descending order
sorted_data = specific_month_data.sort_values(by='claimTotalChargeAmt', ascending=False)

# Calculate the cumulative sum and cumulative percentage
sorted_data['cumulative_sum'] = sorted_data['claimTotalChargeAmt'].cumsum()
sorted_data['cumulative_perc'] = 100 * sorted_data['cumulative_sum'] / sorted_data['claimTotalChargeAmt'].sum()

# Plotting the Pareto chart (Single Cumulative Percentage Line)
fig, ax1 = plt.subplots(figsize=(14, 8))

# Plot the cumulative percentage line (ROC-AUC style)
ax1.plot(sorted_data['cumulative_sum'], sorted_data['cumulative_perc'], color='r', linewidth=2)

# Set the left y-axis for the claim amounts
ax1.set_xlabel('Cumulative Claim Amount')
ax1.set_ylabel('Cumulative Percentage (%)', color='r')
ax1.tick_params(axis='y', labelcolor='r')

# Set limits for the axes
ax1.set_ylim(0, 110)  # Extend y-axis slightly beyond 100% for better visualization
ax1.set_xlim(0, sorted_data['cumulative_sum'].max())  # Limit x-axis to the maximum cumulative sum

# Adding title
plt.title('Pareto Analysis - Cumulative Percentage of Claim Amounts for January 2022')

# Show grid for better readability
plt.grid(True)

# Show the plot
plt.show()
