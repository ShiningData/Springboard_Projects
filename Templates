import shap
import matplotlib.pyplot as plt
import logging

def create_global_shap_plots(
    model,
    X_data,
    global_bar_file,
    global_summary_file,
    class_0_beeswarm_file,
    class_1_beeswarm_file,
):
    """
    Creates and saves global SHAP plots (bar plot, summary plot, and beeswarm plots) for the given model.
    
    Parameters:
    model: The trained model used for generating SHAP values.
    X_data (pd.DataFrame): The dataset features.
    global_bar_file (str): The file path to save the SHAP global bar plot.
    global_summary_file (str): The file path to save the SHAP global summary plot.
    class_0_beeswarm_file (str): The file path to save the SHAP beeswarm plot for class 0.
    class_1_beeswarm_file (str): The file path to save the SHAP beeswarm plot for class 1.

    Returns:
    explainer: The SHAP TreeExplainer object.
    shap_values: The SHAP values for the dataset.
    """
    logging.info("Creating SHAP Global Bar Plot...")
    explainer = shap.TreeExplainer(model)
    shap_values = explainer.shap_values(X_data)

    # Global SHAP Values
    plt.figure(figsize=(12, 8))
    plt.title('Shapley Global Bar Plot')
    plt.tight_layout()
    shap.summary_plot(shap_values, X_data, plot_type="bar")
    plt.savefig(f"report_dir/{global_bar_file}", bbox_inches="tight")
    plt.close()

    logging.info("Creating SHAP Global Summary...")
    plt.figure(figsize=(12, 8))
    shap.summary_plot(shap_values, X_data)
    plt.savefig(f"report_dir/{global_summary_file}", bbox_inches="tight")
    plt.close()

    # SHAP Beeswarm Plot for Class 0
    logging.info("Creating SHAP Beeswarm Plot for Class 0...")
    plt.figure(figsize=(12, 8))
    shap.summary_plot(shap_values[0], X_data, plot_type="dot")
    plt.savefig(f"report_dir/{class_0_beeswarm_file}", bbox_inches="tight")
    plt.close()

    # SHAP Beeswarm Plot for Class 1
    logging.info("Creating SHAP Beeswarm Plot for Class 1...")
    plt.figure(figsize=(12, 8))
    shap.summary_plot(shap_values[1], X_data, plot_type="dot")
    plt.savefig(f"report_dir/{class_1_beeswarm_file}", bbox_inches="tight")
    plt.close()

    return explainer, shap_values
