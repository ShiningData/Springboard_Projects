import pandas as pd
import numpy as np

# Function to create pointed diagnosis codes
def create_pointed_diagnosis_codes(pointers, codes):
    if pd.isna(pointers) or pd.isna(codes):
        return np.nan

    pointers_list = [int(x) for x in str(pointers).split(",")]
    codes_list = str(codes).split("; ")

    # Check if any pointer is out of the range of codes
    if max(pointers_list) > len(codes_list):
        try:
            # Return the first code if there is an out-of-range pointer
            pointed_codes = [codes_list[0]]
            return pointed_codes
        except IndexError:
            return np.nan

    # Select the codes based on valid pointers
    try:
        pointed_codes = [codes_list[pointer - 1] for pointer in pointers_list if pointer <= len(codes_list)]
        return pointed_codes
    except IndexError:
        return np.nan

# Sample data
data = {
    'serviceLineDiagnosisPointers': ['1,4,6', '4,6,9', '2,3'],
    'serviceLineDiagnosisCodes': ['G12; V34; H89; L90; P76; D34; K12; R53; U78', 'E43; G78', 'A12; B34; C56']
}

# Create a DataFrame
df = pd.DataFrame(data)

# Apply the function to create the new column
df['serviceLinedPointedDiagnosisCodes'] = df.apply(
    lambda row: create_pointed_diagnosis_codes(row['serviceLineDiagnosisPointers'], row['serviceLineDiagnosisCodes']),
    axis=1
)

print(df)
