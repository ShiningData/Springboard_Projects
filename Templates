# Ensure categorical features are handled correctly
categorical_features_indices = [X_train.columns.get_loc(col) for col in categorical_features]

# Feature Importance
logger.info("Plotting feature importance...")
train_pool = Pool(X_train, label=y_train, cat_features=categorical_features_indices)
feature_importance = model.get_feature_importance(train_pool)
sorted_idx = feature_importance.argsort()

# Ensure feature names are sorted accordingly
sorted_feature_names = [X_train.columns[i] for i in sorted_idx]

plt.figure(figsize=(10, 7))
plt.barh(sorted_feature_names, feature_importance[sorted_idx], align='center')
plt.xlabel('Feature Importance')
plt.title('Feature Importance')
plt.tight_layout()
plt.savefig(output_path / "feature_importance.png", bbox_inches='tight')
plt.close()
