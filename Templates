import plotly.graph_objects as go
from IPython.display import display

# Unique values for dropdown
orgntd_values = ach_segment['orgntd_trans_ind'].unique()
tran_values = ach_segment['tran_direction'].unique()

# Initialize an empty figure
fig = go.Figure()

# Placeholder for storing the visibility status of each trace
visibility_status = []

# Add traces, one for each filter
for orgntd_trans_ind in orgntd_values:
    for tran_direction in tran_values:
        df_filtered = ach_segment[(ach_segment['orgntd_trans_ind'] == orgntd_trans_ind) & (ach_segment['tran_direction'] == tran_direction)]
        df_filtered = df_filtered.sort_values('total_tran_count', ascending=False)

        visible = (orgntd_trans_ind == orgntd_values[0] and tran_direction == tran_values[0])

        fig.add_trace(
            go.Table(
                header=dict(values=list(df_filtered.columns),
                            fill_color='paleturquoise',
                            align='left'),
                cells=dict(values=[df_filtered[column] for column in df_filtered.columns],
                           fill_color='lavender',
                           align='left'),
                visible=visible
            )
        )
        visibility_status.append(visible)

# Create buttons for dropdown menu
buttons = []
for i, (orgntd_trans_ind, tran_direction) in enumerate(product(orgntd_values, tran_values)):
    visibility = [False] * len(visibility_status)
    visibility[i] = True
    button = dict(
        label = f"{orgntd_trans_ind} & {tran_direction}",
        method = 'update',
        args = [{'visible': visibility},
                {'title': f"orgntd_trans_ind: {orgntd_trans_ind}, tran_direction: {tran_direction}"}]
    )
    buttons.append(button)

# Add dropdown menu to layout
fig.update_layout(
    updatemenus=[
        dict(
            buttons=buttons,
            direction="down",
            pad={"r": 10, "t": 10},
            showactive=True,
            x=0.1,
            xanchor="left",
            y=1.1,
            yanchor="top"
        ),
    ],
    title=f"orgntd_trans_ind: {orgntd_values[0]}, tran_direction: {tran_values[0]}",
    autosize=True,
)

fig.show()
